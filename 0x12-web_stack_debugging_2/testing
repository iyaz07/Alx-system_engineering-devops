#!/usr/bin/env bash

# Remove duplicate user directive from Nginx configuration
sudo sed -i '2d' /etc/nginx/nginx.conf

# Update Nginx configuration to run as nginx user
sudo sed -i '1s/^/user nginx;\n/' /etc/nginx/nginx.conf

# Update Nginx configuration to listen on port 8080
sudo sed -i "s/80 default_server/8080 default_server/g" /etc/nginx/sites-enabled/default

# Ensure correct permissions on configuration files
sudo chown root:root /etc/nginx/nginx.conf
sudo chmod 644 /etc/nginx/nginx.conf

# Check Nginx configuration for syntax errors
sudo nginx -t

# If syntax check is successful, restart Nginx service to apply changes
if [ $? -eq 0 ]; then
    sudo service nginx restart
else
    echo "Error: Nginx configuration syntax check failed."
fi

